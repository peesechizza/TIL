# Chapter 12. 프로세스 동기화

## 12-1. 동기화란

### 동기화의 의미

프로세스들의 수행 시기를 맞추는 것이다. 실행의 문맥을 갖는 모든 대상은 동기화 대상이기에 스레드도 동기화 대상이다.

- 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기
- 상호 배제 : 동시에 접근해서는 안되는 자원에 하나의 프로세스만 접근하게 하기

### 실행 순서 제어를 위한 동기화 : reader writer problem

- Writer : 파일에 값을 저장하는 프로세스
- Reader : 파일에 저장된 값을 읽어들이는 프로세스

Reader와 Writer 프로세스는 실행의 순서가 있기 때문에 아무렇게나 실행되어선 안된다. Reader 프로세스는 파일 안에 값이 존재한다는 특정 조건이 만족되어야만 실행 가능하다.

### 상호 배제를 위한 동기화 : Bank account problem

공유가 불가능한(한 번에 하나의 프로세스만 접근해야하는) 자원의 동시 사용을 피하기 위한 동기화

### 공유 자원과 임계 구역

공동으로 이용하는 변수, 파일, 장치 등의 자원, 여러 프로세스 혹은 스레드가 공유하는 자원을 `공유 자원` 이라 하고, 이 공유 자원에 접근하는 코드 중 동시에 실행하면 문제가 발생하는 코드 영역을 `임계 구역`이라 한다.

임계 구역에 동시에 접근하면 자원의 일관성이 깨질 수 있는데, 이를 `레이스 컨디션` 이라고 한다.

**운영체제가 임계 구역 문제를 해결하는 세 가지 원칙**

1. 상호 배제 : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 들어올 수 없다.
2. 진행 : 임계 구역에 어떤 프로세스도 진입하지 않았다면 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
3. 유한 대기 : 한 프로세스가 임계 구역에 진입하고 싶다면 언젠가는 임계 구역에 들어올 수 있어야 한다. (임계 구역에 들어오기 위해 무한정 대기해서는 안된다.)

## 12-2. 동기화 기법

### 뮤텍스 락

상호 배제를 위한 동기화 도구이다. 뮤텍스 락은 전역 변수 하나, 함수 두 개의 단순한 형태를 갖는다.

- 전역 변수 - 락
- 임계 구역 잠금 함수
- 임계 구역 잠금 해제 함수
- 바쁜 대기 : 임계 구역이 잠금인지 아닌지 계속 확인 하는 것

### 세마포

좀 더 일반화된 방식의 동기화 도구로서 공유 자원이 여러 개 있는 경우에도 적용이 가능하다. 이진 세마포, 카운팅 세마포가 있다.

임계 구역 앞에서 멈춤 신호를 받으면 잠시 기다리며, 임계 구역 앞에서 가도 좋다는 신호를 받으면 임계 구역 진입을 하게 한다.

세마포도 전역 변수 하나, 함수 두 개의 단순한 형태로 나타낼 수 있다.

- 전역 변수 - 임계 구역에 진입할 수 있는 프로세스의 개수 (사용 가능한 공유 자원의 개수)
- 임계 구역에 들어가도 좋은지, 기다려야 할지 알려주는 함수
- 임계 구역 앞에서 기다리는 프로세스에 진입 신호를 주는 함수

Busy waiting은 CPU 사이클을 낭비하게 된다.

- 사용할 수 있는 자원이 없을 경우 대기 상태로 만든다. (해당 프로세스의 PCB를 대기큐에 삽입)
- 사용할 수 있는 자원이 생겼을 경우 대기 큐의 프로세스를 준비 상태로 만든다. (해당 프로세스의 PCB를 대기 큐에서 꺼내 준비큐에 삽입)

세마포를 활용한 실행 순서 동기화

### 모니터

세마포를 사용하면 디버깅할 때 어렵다는 단점이 있다. 그래서 사용자가 다루기에 편한 동기화 도구 모니터가 등장했다.

상호 배제를 위한 동기화, 실행 순서를 위한 동기화 방식을 지원한다.

- 상호 배제를 위한 동기화
  - 인터페이스를 위한 큐
  - 공유자원에 접근하고자 하는 프로세스를 (인터페이스를 위한) 큐에 삽입
  - 큐에 삽입된 순서대로(한 번에 하나의 프로세스만) 공유 자원 이용
- 실행 순서를 위한 동기화
  - 조건 변수 이용
    - 조건변수.wait - 대기 상태로 변경, 조건 변수에 대한 큐에 삽입 / 특정 프로세스가 아직 실행될 조건이 되지 않았을 때에는 실행을 중단한다.
    - 조건변수.signal - 대기 상태로 접어든 조건변수를 실행 상태로 변경 / 특정 프로세그가 실행될 조건이 충족되었을 때에는 실행을 재개한다.
  - 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 함수
