# Chapter 05.  CPU 성능 향상 기법

## 05-1. 빠른 CPU를 위한 설계 기법

### 클럭

컴퓨터 부품들은 `클럭 신호`에 맞춰 일사분란하게 움직인다. CPU는 `명령어 사이클` 이라는 정해진 흐름에 맞춰 명령어들을 실행한다. 

클럭 신호가 빠르게 반복되면 CPU를 비롯한 컴퓨터 부품들은 빠르게 움직이게 되고, 클럭 속도가 높아지면 명령어 사이클을 더 빠르게 반복하게 될 것이고 부품들도 맞춰 빠르게 작동하게 된다.

클럭 속도가 높은 CPU가 일반적으로 성능이 좋고 클럭 속도가 CPU 속도 단위로 간주된다.

클럭 속도는 고성능을 요하는 순간에 순간적으로 클럭 속도를 높이고, 그렇지 않을 때는 클럭 속도를 낮춘다. 최대 클럭 속도를 강제로 더 끌어올리는 기법을 `오버클럭킹`이라 한다.

### 코어와 멀티코어

CPU의 성능을 높이는 방법에 클럭 속도를 높이는 방법 외에 **CPU의 코어와 스레드 수**를 늘리는 방법이 있다. 

`코어` 는 CPU 내에서 **명령어를 실행하는 부품**으로 여러 개 있을 수 있고, CPU는 명령어를 실행하는 부품을 여러 개 포함하는 부품으로 범위가 확장되었다.

`멀티코어 프로세서` 란 여러 개의 코어를 포함하고 있는 CPU를 말한다.

CPU의 속도는 코어 수에 비례하여 증가하지는 않는다. 코어마다 처리할 명령어들을 얼마나 적절히 분배하느냐에 따라 연산 속도가 달라진다.

### 스레드와 멀티 스레드

스레드는 **명령어를 실행하는 단**위이다. 스레드에는 CPU에서 사용되는 하드웨어적 스레드와 프로그램에서 사용되는 소프트웨어적 스레드가 있다.

- **하드웨어적 스레드**
    - 하드웨어적으로 스레드를 정의하면 `하나의 코어가 동시에 처리하는 명령어 단위`를 의미한다.
    - 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 `멀티스레드 프로세서` 또는 `멀티스레드 CPU`라고 한다. 논리 프로세서라고 부르기도 한다.
- **소프트웨어적 스레드**
    - 소프트웨어적으로 정의된 스레드는 `하나의 프로그램에서 독립적으로 실행되는 단위`를 의미한다.
- **멀티스레드 프로세서**
    - 하나의 코어로 여러 명령어를 동시에 처리하는 기술인 하드웨어적 스레드이다.

## 05-2. 명령어 병렬 처리 기법

**명령어를 동시에 처리하여 CPU를 한시도 쉬지 않고 작동시키는 기법**을 명령어 병렬 처리 기법(ILP; Instruction Level Parallelism)이라고 한다.

### 명령어 파이프라인

명령어 처리 과정을 클럭 단위로 나누어 보면 `명령어 인출` → `명령어 해석` → `명령어 실행` → `결과 저장` 으로 나눌 수 있다. 같은 단계가 겹치지만 않는다면 CPU는 각 단계를 동시에 실행할 수 있다.

이 기법을 `명령어 파이프라이닝`이라고 하고 `명령어 파이프라인`에 명령어를 넣고 동시에 처리한다. 특정 상황에서는 성능 향상에 실패하는 경우도 있는데 이 것을 `파이프라인 위험` 이라고 부른다.

- **데이터 위험**
    - 데이터 의존적인 두 명령어를 무작정 동시에 실행하려고 하면 파이프라인이 제대로 작동하지 않는 것이다.
- **제어 위험**
    - 프로그램 카운터는 현재 실행중인 명령어의 다음 주소로 갱신되는데 프로그램 실행 흐름이 바뀌어 명령어가 실행되면서 프로그램 카운터 값에 갑작스러운 변화가 생긴다면 미리 가지고 와서 처리중이었던 명령어들이 아무 쓸모가 없어지게 된다. 이를 위한 사용하는 기술 중 하나가 분기 예측이고 프로그램이 어디로 분기할지 미리 예측한 후 그 주소를 인출하는 기술이다.
- **구조적 위험**
    - 명령어들을 겹쳐 실행하는 과정에서 서로 다른 명령어가 동시에 ALU, 레지스터 등과 같은 CPU 부품을 사용하려고 할 때 발생한다. 자원 위험이라고도 부른다.

### 슈퍼스칼라

CPU 내부에 여러 개의 명령어 파이프라인을 두는 기법이다. 

슈퍼스칼라 구조로 명령어 처리가 가능한 CPU를 `슈퍼스칼라 프로세서` 또는 `슈퍼스칼라 CPU`라고 한다.

### 비순차적 명령어 처리 (OoOE; Out of order execution)

명령어들을 순차적으로 실행하지 않는 기법이다. **명령어를 순차적으로만 실행하지 않고 순서를 바꿔 실행해도 무방한 명령어를 먼저 실행하여 명령어 파이프라인이 멈추는 것을 방지하는 기법이다.**

## 05-3. CISC와 RISC

### 명령어 집합

CPU가 이해할 수 있는 명렁어들의 모음을 `명령어 집합` (instruction set)또는 `명령어 집합 구조` (Instruction Set Architecture; ISA)라고 한다. CPU마다 ISA가 다를 수 있다.

ISA는 CPU의 언어이자 하드웨어가 소프트웨어를 어떻게 이해할지에 대한 약속이다.

### CISC

CISC는 Complex Instruction Set Computer의 약자이다. **복잡하고 다양한 명령어들을 활용하는 CPU 설계 방식**이다. 

CISC 명령어 집합은 복잡하고 다양한 기능을 제공하기에 적은 수의 명령으로 프로그램을 동작시키고 메모리를 절약할 수 있지만, 명령어의 규격화가 어려워 파이프라이닝이 어렵다. 그리고 대다수의 복잡한 명령어는 그 사용 빈도가 낮아 CISC 기반 CPU는 성장에 한계가 있다.

### RISC

RISC는 Reduced Instruction Set Computer의 약자로 CISC에 비해 명령어의 종류가 적다. CISC와는 달리 단순하고 적은 수의 고정 길이 명령어 집합을 활용한다. RISC는 짧고 규격화된 명령어를 활용하기에 명령어 파이프라이닝에 유리하다.
| CISC | RISC |
| --- | --- |
| 복잡하고 다양한 명령어 | 단순하고 적은 명령어 |
| 가변 길이 명령어 | 고정 길이 명령어 |
| 다양한 주소 지정 방식 | 적은 주소 지정 방식 |
| 프로그램을 이루는 명령어의 수가 적음 | 프로그램을 이루는 명령어의 수가 많음 |
| 여러 클럭에 걸쳐 명령어 수행 | 1클럭 내외로 명령어 수행 |
| 파이프라이닝하기 어려움 | 파이프라이닝하기 쉬움 |