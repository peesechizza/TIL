# 7. 메모리 구조와 static

## 자바 메모리 구조

- **메서드 영역 (Method Area)**
  - 클래스 정보 : 클래스의 실행 코드(바이트 코드), 필드, 메서드와 생성자 코드 등 모든 실행 코드가 존재한다.
  - static 영역 : `static` 변수들을 보관한다.
  - 런타임 상수 풀 : 프로그램을 실행하는데 필요한 공통 리터럴 상수를 보관한다. 이 외에도 프로그램을 효율적으로 관리하기 위한 상수들을 관리한다.
- **스택 영역 (Stack Area)**
  - 자바 실행 시 하나의 실행 스택이 생성된다. 각 스택 프레임은 지역 변수, 중간 연산 결과, 메서드 호출 정보 등을 포함하낟.
  - 스택 프레임 : 스택 영역에 쌓이는 네모 박스가 하나의 스택 프레임이다. 메서드를 호출할 때 마다 하나의 스택 프레임이 쌓이고, 메서드가 종료되면 해당 스택 프레임이 제거된다.
- **힙 영역 (Heap Area)**
  - 객체(인스턴스), 배열이 생성되는 영역이다. `new` 명령어를 사용하면 이 영역을 사용한다. 가비지 컬렉션(GC)이 이루어지는 주요 영역이며, 더 이상 참조되지 않는 객체는 GC에 의해 제거된다.

## 메서드 영역

자바에서 특정 클래스로 인스턴스롤 생성하면, 힙 메모리에 인스턴스가 쌓인다. 각각의 인스턴스는 내부에 변수와 메서드를 가진다.

같은 클래스로 부터 생성된 객체라도, 인스턴스 내부의 변수 값은 서로 다를 수 있지만, 메서드는 공통된 코드를 공유한다.

따라서 객체가 생성될 때, 인스턴스 변수에는 메모리가 할당되지만 메서드에 대한 새로운 메모리 할당은 없다. 메서드는 메서드 영역에서 공통으로 관리되고 실행된다.

**인스턴스의 메서드를 호출하면 실제로는 메서드 영역에 있는 코드를 불러서 수행한다.**

## 스택과 큐 자료 구조

### 스택 구조

스택은 위쪽만 열려있기 때문에 위쪽으로 블럭을 넣고 빼야한다.

- 자바는 스택 영역을 사용해서 메서드 호출과 지역 변수(매개변수 포함)를 관리한다.
- 메서드를 계속 호출하면 스택 프레임이 계속 쌓인다.
- 지역 변수(매개변수 포함)는 스택 영역에서 관리한다.
- 스택 프레임이 종료되면 지역 변수도 함께 제거된다.
- 스택 프레임이 모두 제거되면 프로그램도 종료된다.

### 후입 선출 (LIFO, Last In First Out)

나중에 넣은 것이 가장 먼저 나오는 것을 후입 선출이라고 하고, 이런 자료 구조를 스택이라 한다.

### 선입 선출 (FIFO, First In First Out)

후입 선출과 반대로 가장 먼저 넣은 것이 가장 먼저 나오는 것을 선입 선출이라 한다. 이런 자료 구조를 큐(Queue(라고 한다.

## 스택 영역과 힙 영역

지역 변수는 스택 영역에, 객체(인스턴스)는 힙 영역에 관리된다.

## static

`static` 키워드는 주로 멤버 변수와 메서드에 사용된다.

### 멤버 변수(필드)의 종류

- **인스턴스 변수**
  - static이 붙지 않은 멤버 변수로 인스턴스를 생성해야 사용할 수 있고, 인스턴스에 소속되어 있다.
  - 인스턴스를 만들 때 마다 새로 만들어진다.
- **클래스 변수**
  - static이 붙은 멤버 변수로 클래스 변수, 정적 변수, static 변수 등으로 부른다.
  - 인스턴스와 무관하게 클래스에 바로 접근해서 사용할 수 있고, 클래스 자체에 소속되어 있다.
  - 클래스 변수는 자바 프로그램을 시작할 때 딱 1개가 만들어진다. 인스턴스와는 다르게 보통 여러곳에서 공유하는 목적으로 사용된다.

### 변수와 생명주기

- 지역 변수
  - 스택 영역에 있는 스택 프레임 안에 보관된다. 메서드가 종료되면 스택 프레임과 함께 포함된 지역 변수도 함께 제거된다.
- 인스턴스 변수
  - 인스턴스에 있는 멤버 변수로 힙 영역을 사용한다. 가비지 컬렉션이 발생하기 전까지는 생존하기 때문에 보통 지역 변수보다 생존 주기가 길다.
- 클래스 변수
  - 메서드 영역의 static 영역에 보관되는 변수이다. 클래스 변수는 해당 클래스가 JVM에 로딩되는 순간 생성되어 종료될 때 까지 생명주기가 이어진다.

### Static member accessed via instance reference

이 경고 메시지는 Java에서 **`static`** 멤버(정적 멤버)를 클래스의 인스턴스를 통해 접근할 때 발생하는 경고다. 정적 멤버는 클래스 이름으로 직접 접근하는 것이 권장된

경고 메시지는 코드의 가독성을 향상시키기 위한 권장사항으로, 정적 멤버에는 클래스 이름을 사용하는 것이 좋다. 따라서 경고를 없애려면 클래스 이름을 사용하여 접근하면 된다:

## static 메서드

### 클래스 메서드

메서드 앞에 static을 붙인 것으로 정적 메서드 또는 클래스 메서드라 한다. 정적 메서드는 객체 생성없이 클래스에 있는 메서드를 바로 호출할 수 있지만 언제나 사용할 수 있는 것은 아니다.

객체 생성이 필요 없이 메서드의 호출만으로 필요한 기능을 수행할 때 주로 사용한다.

### 정적 메서드 사용법

- 클래스 내부의 기능을 사용할 때, 정적 메서드는 static이 붙은 정적 메서드나 정적 변수만 사용할 수 있고, 인스턴스 변수나 인스턴스 메서드는 사용할 수 없다.
- 인스턴스 기능을 사용하려면 참조값을 알아야 하는데 정적 메서드는 참조값 없이 호출하기 때문에 정적 메서드 안에서 인스턴스 기능을 사용할 수 없다.
- 정적 메서드는 접근 제어자만 허락한다면 클래스를 통해 모든 곳에서 `static`을 호출할 수 있다.
- 자주 호출 해야한다면 `import static` 을 사용한다.

### Non-static field cannot be referenced from a static context

이 경고 메시지는 Java에서 static 메서드에서 인스턴스 변수를 사용할 수 없다는 경고이다.

### 인스턴스 메서드

`static` 이 붙지 않은 메서드는 인스턴스를 생성해야 호출할 수 있다.
